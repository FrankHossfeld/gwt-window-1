plugins {
  id "java-library"
  id "maven"
}

group = "org.gwtproject.user.window"
version = "HEAD-SNAPSHOT"

repositories {
  mavenCentral()
}

dependencies {
  api "org.gwtproject.event:gwt-logical-event:HEAD-SNAPSHOT"
  api "org.gwtproject.http:gwt-http:HEAD-SNAPSHOT"
  implementation "com.google.elemental2:elemental2-dom:1.0.0-beta-1"

  testImplementation "junit:junit:4.12"
  testImplementation "com.google.gwt:gwt-user:2.8.2"
  testImplementation "com.google.gwt:gwt-dev:2.8.2"
}

sourceCompatibility = JavaVersion.VERSION_1_8
tasks.withType(JavaCompile) {
  options.encoding = "UTF-8"
}

jar {
  from sourceSets.main.allJava
}

test {
  def warDir = file("$buildDir/gwt/www-test")
  def workDir = file("$buildDir/gwt/work")
  def cacheDir = file("$buildDir/gwt/cache")
  doFirst {
    mkdir(warDir)
    mkdir(workDir)
    mkdir(cacheDir)
  }

  classpath += sourceSets.main.allJava.sourceDirectories + sourceSets.test.allJava.sourceDirectories
  include "**/*Suite.class"
  systemProperty("gwt.args", "-ea -draftCompile -batch module -war \"$warDir\" -workDir \"$workDir\" -runStyle HtmlUnit:Chrome")
  systemProperty("gwt.persistentunitcachedir", cacheDir)
}

javadoc {
  options.addBooleanOption("Xdoclint:all,-missing", true)
}

// Pending deployment on Sonatype OSS or other "real" Maven repository, use Jitpack for snapshots
repositories {
  maven { url 'https://jitpack.io/' }
}
configurations.all*.resolutionStrategy*.dependencySubstitution {
  substitute module('org.gwtproject.event:gwt-logical-event') with module('com.github.tbroyer.gwt-events:gwt-logical-event:-SNAPSHOT')
  substitute module('org.gwtproject.http:gwt-http') with module('com.github.tbroyer:gwt-http:-SNAPSHOT')
}
